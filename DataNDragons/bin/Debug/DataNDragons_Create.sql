/*
Deployment script for DataNDragons

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "DataNDragons"
:setvar DefaultFilePrefix "DataNDragons"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)] COLLATE SQL_Latin1_General_CP1_CI_AS
GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT OFF,
                CONCAT_NULL_YIELDS_NULL OFF,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT GLOBAL,
                RECOVERY SIMPLE,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY CHECKSUM,
                DATE_CORRELATION_OPTIMIZATION OFF,
                ENABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 60 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (QUERY_CAPTURE_MODE = ALL, DATA_FLUSH_INTERVAL_SECONDS = 900, INTERVAL_LENGTH_MINUTES = 60, MAX_PLANS_PER_QUERY = 200, CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30), MAX_STORAGE_SIZE_MB = 100) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE = OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
    END


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [dbo].[EFFECT]...';


GO
CREATE TABLE [dbo].[EFFECT] (
    [ef_id]           INT           NOT NULL,
    [ef_name]         VARCHAR (150) NULL,
    [ef_desc]         VARCHAR (MAX) NULL,
    [ef_hasprocedure] BIT           NULL,
    PRIMARY KEY CLUSTERED ([ef_id] ASC)
);


GO
PRINT N'Creating [dbo].[EPISODE]...';


GO
CREATE TABLE [dbo].[EPISODE] (
    [ep_id]    INT           NOT NULL,
    [ep_cmpid] INT           NOT NULL,
    [ep_date]  DATE          NULL,
    [ep_desc]  VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([ep_id] ASC)
);


GO
PRINT N'Creating [dbo].[QUESTLINE]...';


GO
CREATE TABLE [dbo].[QUESTLINE] (
    [ql_id]          INT           NOT NULL,
    [q_cmpid]        INT           NOT NULL,
    [ql_title]       VARCHAR (250) NULL,
    [ql_description] VARCHAR (MAX) NULL,
    CONSTRAINT [PK_QUESTLINE] PRIMARY KEY CLUSTERED ([ql_id] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_PROFICIENCIES]...';


GO
CREATE TABLE [dbo].[CHARACTER_PROFICIENCIES] (
    [cp_cid] INT NOT NULL,
    [cp_pid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([cp_cid] ASC, [cp_pid] ASC)
);


GO
PRINT N'Creating [dbo].[PROFICIENCY]...';


GO
CREATE TABLE [dbo].[PROFICIENCY] (
    [p_id]   INT           NOT NULL,
    [p_name] VARCHAR (100) NULL,
    [p_type] VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([p_id] ASC)
);


GO
PRINT N'Creating [dbo].[GRAVEYARD]...';


GO
CREATE TABLE [dbo].[GRAVEYARD] (
    [g_cmpid] INT NOT NULL,
    [g_cid]   INT NOT NULL,
    CONSTRAINT [PK_GRAVEYARD] PRIMARY KEY CLUSTERED ([g_cid] ASC, [g_cmpid] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_FEATS]...';


GO
CREATE TABLE [dbo].[CHARACTER_FEATS] (
    [cf_cid] INT NOT NULL,
    [cf_fid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([cf_fid] ASC, [cf_cid] ASC)
);


GO
PRINT N'Creating [dbo].[FEATS]...';


GO
CREATE TABLE [dbo].[FEATS] (
    [f_id]   INT        NOT NULL,
    [f_name] NCHAR (10) NULL,
    PRIMARY KEY CLUSTERED ([f_id] ASC)
);


GO
PRINT N'Creating [dbo].[QUEST]...';


GO
CREATE TABLE [dbo].[QUEST] (
    [q_id]        INT           NOT NULL,
    [q_qlid]      INT           NOT NULL,
    [q_title]     VARCHAR (MAX) NULL,
    [q_desc]      VARCHAR (MAX) NULL,
    [q_startdate] DATE          NULL,
    [q_next]      INT           NULL,
    CONSTRAINT [PK_QUEST] PRIMARY KEY CLUSTERED ([q_id] ASC)
);


GO
PRINT N'Creating [dbo].[CAMPAIGN]...';


GO
CREATE TABLE [dbo].[CAMPAIGN] (
    [cmp_id]        INT           NOT NULL,
    [cmp_name]      VARCHAR (250) NULL,
    [cmp_startdate] DATE          NULL,
    [cmp_dm]        VARCHAR (50)  NULL,
    PRIMARY KEY CLUSTERED ([cmp_id] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_SPELLBOOK]...';


GO
CREATE TABLE [dbo].[CHARACTER_SPELLBOOK] (
    [cs_cid] INT NOT NULL,
    [cs_sid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([cs_cid] ASC, [cs_sid] ASC)
);


GO
PRINT N'Creating [dbo].[SPELLS]...';


GO
CREATE TABLE [dbo].[SPELLS] (
    [s_id]                 INT           NOT NULL,
    [s_name]               VARCHAR (250) NULL,
    [s_school]             VARCHAR (100) NULL,
    [s_isritual]           BIT           NULL,
    [s_castingtimeminutes] INT           NULL,
    [s_range]              VARCHAR (10)  NULL,
    [s_target]             VARCHAR (100) NULL,
    [s_component_v]        BIT           NULL,
    [s_component_s]        BIT           NULL,
    [s_component_m]        VARCHAR (250) NULL,
    [s_isconcentration]    BIT           NULL,
    [s_durationminutes]    INT           NULL,
    PRIMARY KEY CLUSTERED ([s_id] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_INVENTORY]...';


GO
CREATE TABLE [dbo].[CHARACTER_INVENTORY] (
    [ci_cid]          INT NOT NULL,
    [ci_iid]          INT NOT NULL,
    [ci_itemquantity] INT NULL,
    PRIMARY KEY CLUSTERED ([ci_cid] ASC, [ci_iid] ASC)
);


GO
PRINT N'Creating [dbo].[CAMPAIGN_PLAYER_CHARACTERS]...';


GO
CREATE TABLE [dbo].[CAMPAIGN_PLAYER_CHARACTERS] (
    [cpc_cmpid]    INT           NOT NULL,
    [cpc_cid]      INT           NULL,
    [cpc_playedby] VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([cpc_cmpid] ASC)
);


GO
PRINT N'Creating [dbo].[BACKGROUND]...';


GO
CREATE TABLE [dbo].[BACKGROUND] (
    [b_id]   INT           NOT NULL,
    [b_desc] VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([b_id] ASC)
);


GO
PRINT N'Creating [dbo].[ENCOUNTER]...';


GO
CREATE TABLE [dbo].[ENCOUNTER] (
    [e_id]   INT           NOT NULL,
    [e_lid]  INT           NULL,
    [e_desc] VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([e_id] ASC)
);


GO
PRINT N'Creating [dbo].[SUBLOCATION]...';


GO
CREATE TABLE [dbo].[SUBLOCATION] (
    [sl_parent] INT NOT NULL,
    [sl_child]  INT NOT NULL,
    PRIMARY KEY CLUSTERED ([sl_parent] ASC, [sl_child] ASC)
);


GO
PRINT N'Creating [dbo].[LOCATION]...';


GO
CREATE TABLE [dbo].[LOCATION] (
    [l_id]   INT           NOT NULL,
    [l_name] VARCHAR (MAX) NULL,
    [l_bid]  INT           NULL,
    PRIMARY KEY CLUSTERED ([l_id] ASC)
);


GO
PRINT N'Creating [dbo].[ITEM]...';


GO
CREATE TABLE [dbo].[ITEM] (
    [i_id]     INT          NOT NULL,
    [i_weight] DECIMAL (18) NULL,
    [i_gp]     DECIMAL (18) NULL,
    PRIMARY KEY CLUSTERED ([i_id] ASC)
);


GO
PRINT N'Creating [dbo].[ITEM_BACKGROUND]...';


GO
CREATE TABLE [dbo].[ITEM_BACKGROUND] (
    [ib_iid] INT NOT NULL,
    [ib_bid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([ib_bid] ASC, [ib_iid] ASC)
);


GO
PRINT N'Creating [dbo].[QUEST_BACKGROUND]...';


GO
CREATE TABLE [dbo].[QUEST_BACKGROUND] (
    [qb_qid] INT NOT NULL,
    [qb_bid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([qb_bid] ASC, [qb_qid] ASC)
);


GO
PRINT N'Creating [dbo].[QUESTLINE_BACKGROUND]...';


GO
CREATE TABLE [dbo].[QUESTLINE_BACKGROUND] (
    [qlb_qlid] INT NOT NULL,
    [qlb_bid]  INT NOT NULL,
    PRIMARY KEY CLUSTERED ([qlb_bid] ASC, [qlb_qlid] ASC)
);


GO
PRINT N'Creating [dbo].[LOCATION_BACKGROUND]...';


GO
CREATE TABLE [dbo].[LOCATION_BACKGROUND] (
    [lb_lid] INT NOT NULL,
    [lb_bid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([lb_lid] ASC, [lb_bid] ASC)
);


GO
PRINT N'Creating [dbo].[CAMPAIGN_BACKGROUND]...';


GO
CREATE TABLE [dbo].[CAMPAIGN_BACKGROUND] (
    [cmpb_cmpid] INT NOT NULL,
    [cmpb_bid]   INT NOT NULL,
    PRIMARY KEY CLUSTERED ([cmpb_bid] ASC, [cmpb_cmpid] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_BACKGROUND]...';


GO
CREATE TABLE [dbo].[CHARACTER_BACKGROUND] (
    [cb_cid] INT NOT NULL,
    [cb_bid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([cb_bid] ASC, [cb_cid] ASC)
);


GO
PRINT N'Creating [dbo].[SPELLS_SLOTS]...';


GO
CREATE TABLE [dbo].[SPELLS_SLOTS] (
    [ss_id]   INT NOT NULL,
    [ss_lvl1] INT NULL,
    [ss_lvl2] INT NULL,
    [ss_lvl3] INT NULL,
    [ss_lvl4] INT NULL,
    [ss_lvl5] INT NULL,
    [ss_lvl6] INT NULL,
    [ss_lvl7] INT NULL,
    [ss_lvl8] INT NULL,
    [ss_lvl9] INT NULL,
    PRIMARY KEY CLUSTERED ([ss_id] ASC)
);


GO
PRINT N'Creating [dbo].[SPELLS_EFFECT]...';


GO
CREATE TABLE [dbo].[SPELLS_EFFECT] (
    [sef_sid]  INT NOT NULL,
    [sef_efid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([sef_efid] ASC, [sef_sid] ASC)
);


GO
PRINT N'Creating [dbo].[ITEM_EFFECT]...';


GO
CREATE TABLE [dbo].[ITEM_EFFECT] (
    [ie_iid]  INT NOT NULL,
    [if_efid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([if_efid] ASC, [ie_iid] ASC)
);


GO
PRINT N'Creating [dbo].[EFFECT_PROCEDURE]...';


GO
CREATE TABLE [dbo].[EFFECT_PROCEDURE] (
    [efp_id]        INT           NOT NULL,
    [efp_efid]      INT           NOT NULL,
    [efp_procedure] VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([efp_id] ASC)
);


GO
PRINT N'Creating [dbo].[EVENT_OCCURRED_TYPES]...';


GO
CREATE TABLE [dbo].[EVENT_OCCURRED_TYPES] (
    [eot_eoid] INT NOT NULL,
    [eot_etid] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([eot_etid] ASC, [eot_eoid] ASC)
);


GO
PRINT N'Creating [dbo].[EVENT_TYPE]...';


GO
CREATE TABLE [dbo].[EVENT_TYPE] (
    [et_id]   INT           NOT NULL,
    [et_name] VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([et_id] ASC)
);


GO
PRINT N'Creating [dbo].[RACE_BACKGROUND]...';


GO
CREATE TABLE [dbo].[RACE_BACKGROUND] (
    [rb_rid] INT NOT NULL,
    [rb_bid] INT NOT NULL,
    CONSTRAINT [PK_RACE_BACKGROUND] PRIMARY KEY CLUSTERED ([rb_rid] ASC, [rb_bid] ASC)
);


GO
PRINT N'Creating [dbo].[SKILL]...';


GO
CREATE TABLE [dbo].[SKILL] (
    [s_id]             INT NOT NULL,
    [s_animalhandling] INT NOT NULL,
    [s_arcana]         INT NOT NULL,
    [s_athletics]      INT NOT NULL,
    [s_deception]      INT NOT NULL,
    [s_history]        INT NOT NULL,
    [s_insight]        INT NOT NULL,
    [s_intimidation]   INT NOT NULL,
    [s_medicine]       INT NOT NULL,
    [s_nature]         INT NOT NULL,
    [s_perception]     INT NOT NULL,
    [s_performance]    INT NOT NULL,
    [s_persuasion]     INT NOT NULL,
    [s_religion]       INT NOT NULL,
    [s_sleightofhand]  INT NOT NULL,
    [s_stealth]        INT NOT NULL,
    [s_survival]       INT NOT NULL,
    CONSTRAINT [PK_SKILL] PRIMARY KEY CLUSTERED ([s_id] ASC)
);


GO
PRINT N'Creating [dbo].[ABILITY]...';


GO
CREATE TABLE [dbo].[ABILITY] (
    [a_id]  INT NOT NULL,
    [a_CHA] INT NULL,
    [a_CON] INT NULL,
    [a_DEX] INT NULL,
    [a_INT] INT NULL,
    [a_STR] INT NULL,
    [a_WIS] INT NULL,
    PRIMARY KEY CLUSTERED ([a_id] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER_CLASSES]...';


GO
CREATE TABLE [dbo].[CHARACTER_CLASSES] (
    [ccl_cid]   INT NOT NULL,
    [ccl_clid]  INT NOT NULL,
    [ccl_level] INT NULL,
    PRIMARY KEY CLUSTERED ([ccl_clid] ASC, [ccl_cid] ASC)
);


GO
PRINT N'Creating [dbo].[RACE]...';


GO
CREATE TABLE [dbo].[RACE] (
    [r_id]   INT           NOT NULL,
    [r_aid]  INT           NULL,
    [r_sid]  INT           NULL,
    [r_name] VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([r_id] ASC)
);


GO
PRINT N'Creating [dbo].[CLASS]...';


GO
CREATE TABLE [dbo].[CLASS] (
    [cl_id]   INT           NOT NULL,
    [cl_name] VARCHAR (100) NULL,
    [cl_aid]  INT           NULL,
    [cl_sid]  INT           NULL,
    CONSTRAINT [PK_CLASS] PRIMARY KEY CLUSTERED ([cl_id] ASC)
);


GO
PRINT N'Creating [dbo].[CHARACTER]...';


GO
CREATE TABLE [dbo].[CHARACTER] (
    [c_id]                   INT           NOT NULL,
    [c_name]                 VARCHAR (100) NULL,
    [c_rid]                  INT           NULL,
    [c_alignment]            VARCHAR (2)   NULL,
    [c_aid]                  INT           NULL,
    [c_sid]                  INT           NULL,
    [c_hpcurrent]            INT           NULL,
    [c_hpmax]                INT           NULL,
    [c_hptemp]               INT           NULL,
    [c_inspiration]          BIT           NULL,
    [c_spellslots_remaining] INT           NULL,
    [c_spellslots_total]     INT           NULL,
    [c_bid]                  INT           NULL,
    [c_isNPC]                BIT           NULL,
    PRIMARY KEY CLUSTERED ([c_id] ASC)
);


GO
PRINT N'Creating [dbo].[EVENT_OCCURRED]...';


GO
CREATE TABLE [dbo].[EVENT_OCCURRED] (
    [eo_id]    INT           NOT NULL,
    [eo_cmpid] INT           NULL,
    [eo_lid]   INT           NULL,
    [eo_desc]  VARCHAR (MAX) NULL,
    [eo_start] DATETIME      NULL,
    [eo_end]   DATETIME      NULL,
    PRIMARY KEY CLUSTERED ([eo_id] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[EPISODE]...';


GO
ALTER TABLE [dbo].[EPISODE]
    ADD DEFAULT GETDATE() FOR [ep_date];


GO
PRINT N'Creating unnamed constraint on [dbo].[CAMPAIGN]...';


GO
ALTER TABLE [dbo].[CAMPAIGN]
    ADD DEFAULT (getdate()) FOR [cmp_startdate];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS]...';


GO
ALTER TABLE [dbo].[SPELLS]
    ADD DEFAULT 0 FOR [s_isritual];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl1];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl2];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl3];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl4];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl5];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl6];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl7];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl8];


GO
PRINT N'Creating unnamed constraint on [dbo].[SPELLS_SLOTS]...';


GO
ALTER TABLE [dbo].[SPELLS_SLOTS]
    ADD DEFAULT 0 FOR [ss_lvl9];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_animalhandling];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_arcana];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_athletics];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_deception];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_history];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_insight];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_intimidation];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_medicine];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_nature];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_perception];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_performance];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_persuasion];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_religion];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_sleightofhand];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_stealth];


GO
PRINT N'Creating unnamed constraint on [dbo].[SKILL]...';


GO
ALTER TABLE [dbo].[SKILL]
    ADD DEFAULT 0 FOR [s_survival];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_CHA];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_CON];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_DEX];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_INT];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_STR];


GO
PRINT N'Creating unnamed constraint on [dbo].[ABILITY]...';


GO
ALTER TABLE [dbo].[ABILITY]
    ADD DEFAULT 0 FOR [a_WIS];


GO
PRINT N'Creating unnamed constraint on [dbo].[CHARACTER_CLASSES]...';


GO
ALTER TABLE [dbo].[CHARACTER_CLASSES]
    ADD DEFAULT 0 FOR [ccl_level];


GO
PRINT N'Creating [dbo].[FK_EPISODE_ToCAMPAIGN]...';


GO
ALTER TABLE [dbo].[EPISODE]
    ADD CONSTRAINT [FK_EPISODE_ToCAMPAIGN] FOREIGN KEY ([ep_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
PRINT N'Creating [dbo].[FK_QUESTLINE_ToCAMPAIGN]...';


GO
ALTER TABLE [dbo].[QUESTLINE]
    ADD CONSTRAINT [FK_QUESTLINE_ToCAMPAIGN] FOREIGN KEY ([q_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_PROFICIENCIES_ToCHARACTER]...';


GO
ALTER TABLE [dbo].[CHARACTER_PROFICIENCIES]
    ADD CONSTRAINT [FK_CHARACTER_PROFICIENCIES_ToCHARACTER] FOREIGN KEY ([cp_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_PROFICIENCIES_ToPROFICIENCY]...';


GO
ALTER TABLE [dbo].[CHARACTER_PROFICIENCIES]
    ADD CONSTRAINT [FK_CHARACTER_PROFICIENCIES_ToPROFICIENCY] FOREIGN KEY ([cp_pid]) REFERENCES [dbo].[PROFICIENCY] ([p_id]);


GO
PRINT N'Creating [dbo].[FK_GRAVEYARD_ToCAMPAIGN]...';


GO
ALTER TABLE [dbo].[GRAVEYARD]
    ADD CONSTRAINT [FK_GRAVEYARD_ToCAMPAIGN] FOREIGN KEY ([g_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
PRINT N'Creating [dbo].[FK_GRAVEYARD_ToCHARACTER]...';


GO
ALTER TABLE [dbo].[GRAVEYARD]
    ADD CONSTRAINT [FK_GRAVEYARD_ToCHARACTER] FOREIGN KEY ([g_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_FEATS_ToCHARACTER]...';


GO
ALTER TABLE [dbo].[CHARACTER_FEATS]
    ADD CONSTRAINT [FK_CHARACTER_FEATS_ToCHARACTER] FOREIGN KEY ([cf_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_FEATS_ToFEATS]...';


GO
ALTER TABLE [dbo].[CHARACTER_FEATS]
    ADD CONSTRAINT [FK_CHARACTER_FEATS_ToFEATS] FOREIGN KEY ([cf_fid]) REFERENCES [dbo].[FEATS] ([f_id]);


GO
PRINT N'Creating [dbo].[FK_QUEST_ToQUESTLINE]...';


GO
ALTER TABLE [dbo].[QUEST]
    ADD CONSTRAINT [FK_QUEST_ToQUESTLINE] FOREIGN KEY ([q_qlid]) REFERENCES [dbo].[QUESTLINE] ([ql_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_SPELLBOOK_ToCHARACER]...';


GO
ALTER TABLE [dbo].[CHARACTER_SPELLBOOK]
    ADD CONSTRAINT [FK_CHARACTER_SPELLBOOK_ToCHARACER] FOREIGN KEY ([cs_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_SPELLBOOK_ToSPELLS]...';


GO
ALTER TABLE [dbo].[CHARACTER_SPELLBOOK]
    ADD CONSTRAINT [FK_CHARACTER_SPELLBOOK_ToSPELLS] FOREIGN KEY ([cs_sid]) REFERENCES [dbo].[SPELLS] ([s_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_INVENTORY_ToCharacter]...';


GO
ALTER TABLE [dbo].[CHARACTER_INVENTORY]
    ADD CONSTRAINT [FK_CHARACTER_INVENTORY_ToCharacter] FOREIGN KEY ([ci_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_INVENTORY_ToItem]...';


GO
ALTER TABLE [dbo].[CHARACTER_INVENTORY]
    ADD CONSTRAINT [FK_CHARACTER_INVENTORY_ToItem] FOREIGN KEY ([ci_iid]) REFERENCES [dbo].[ITEM] ([i_id]);


GO
PRINT N'Creating [dbo].[FK_CAMPAIGN_PLAYER_CHARACTERS_ToCampaign]...';


GO
ALTER TABLE [dbo].[CAMPAIGN_PLAYER_CHARACTERS]
    ADD CONSTRAINT [FK_CAMPAIGN_PLAYER_CHARACTERS_ToCampaign] FOREIGN KEY ([cpc_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
PRINT N'Creating [dbo].[FK_CAMPAIGN_PLAYER_CHARACTERS_ToCharacter]...';


GO
ALTER TABLE [dbo].[CAMPAIGN_PLAYER_CHARACTERS]
    ADD CONSTRAINT [FK_CAMPAIGN_PLAYER_CHARACTERS_ToCharacter] FOREIGN KEY ([cpc_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_ENCOUNTER_ToLocation]...';


GO
ALTER TABLE [dbo].[ENCOUNTER]
    ADD CONSTRAINT [FK_ENCOUNTER_ToLocation] FOREIGN KEY ([e_lid]) REFERENCES [dbo].[LOCATION] ([l_id]);


GO
PRINT N'Creating [dbo].[FK_SUBLOCATION_ToLocation_Child]...';


GO
ALTER TABLE [dbo].[SUBLOCATION]
    ADD CONSTRAINT [FK_SUBLOCATION_ToLocation_Child] FOREIGN KEY ([sl_child]) REFERENCES [dbo].[LOCATION] ([l_id]);


GO
PRINT N'Creating [dbo].[FK_SUBLOCATION_ToLocation_Parent]...';


GO
ALTER TABLE [dbo].[SUBLOCATION]
    ADD CONSTRAINT [FK_SUBLOCATION_ToLocation_Parent] FOREIGN KEY ([sl_parent]) REFERENCES [dbo].[LOCATION] ([l_id]);


GO
PRINT N'Creating [dbo].[FK_ITEM_BACKGROUND_ToITEM]...';


GO
ALTER TABLE [dbo].[ITEM_BACKGROUND]
    ADD CONSTRAINT [FK_ITEM_BACKGROUND_ToITEM] FOREIGN KEY ([ib_iid]) REFERENCES [dbo].[ITEM] ([i_id]);


GO
PRINT N'Creating [dbo].[FK_ITEM_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[ITEM_BACKGROUND]
    ADD CONSTRAINT [FK_ITEM_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([ib_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_QUEST_BACKGROUND_ToQUEST]...';


GO
ALTER TABLE [dbo].[QUEST_BACKGROUND]
    ADD CONSTRAINT [FK_QUEST_BACKGROUND_ToQUEST] FOREIGN KEY ([qb_qid]) REFERENCES [dbo].[QUEST] ([q_id]);


GO
PRINT N'Creating [dbo].[FK_QUEST_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[QUEST_BACKGROUND]
    ADD CONSTRAINT [FK_QUEST_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([qb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_QUESTLINE_BACKGROUND_ToQUESTLINE]...';


GO
ALTER TABLE [dbo].[QUESTLINE_BACKGROUND]
    ADD CONSTRAINT [FK_QUESTLINE_BACKGROUND_ToQUESTLINE] FOREIGN KEY ([qlb_qlid]) REFERENCES [dbo].[QUESTLINE] ([ql_id]);


GO
PRINT N'Creating [dbo].[FK_QUESTLINE_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[QUESTLINE_BACKGROUND]
    ADD CONSTRAINT [FK_QUESTLINE_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([qlb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_LOCATION_BACKGROUND_ToLOCATION]...';


GO
ALTER TABLE [dbo].[LOCATION_BACKGROUND]
    ADD CONSTRAINT [FK_LOCATION_BACKGROUND_ToLOCATION] FOREIGN KEY ([lb_lid]) REFERENCES [dbo].[LOCATION] ([l_id]);


GO
PRINT N'Creating [dbo].[FK_LOCATION_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[LOCATION_BACKGROUND]
    ADD CONSTRAINT [FK_LOCATION_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([lb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_CAMPAIGN_BACKGROUND_ToCAMPAIGN]...';


GO
ALTER TABLE [dbo].[CAMPAIGN_BACKGROUND]
    ADD CONSTRAINT [FK_CAMPAIGN_BACKGROUND_ToCAMPAIGN] FOREIGN KEY ([cmpb_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
PRINT N'Creating [dbo].[FK_CAMPAIGN_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[CAMPAIGN_BACKGROUND]
    ADD CONSTRAINT [FK_CAMPAIGN_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([cmpb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_BACKGROUND_ToCHARACTER]...';


GO
ALTER TABLE [dbo].[CHARACTER_BACKGROUND]
    ADD CONSTRAINT [FK_CHARACTER_BACKGROUND_ToCHARACTER] FOREIGN KEY ([cb_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[CHARACTER_BACKGROUND]
    ADD CONSTRAINT [FK_CHARACTER_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([cb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_SPELLS_EFFECT_ToSPELLS]...';


GO
ALTER TABLE [dbo].[SPELLS_EFFECT]
    ADD CONSTRAINT [FK_SPELLS_EFFECT_ToSPELLS] FOREIGN KEY ([sef_sid]) REFERENCES [dbo].[SPELLS] ([s_id]);


GO
PRINT N'Creating [dbo].[FK_SPELLS_EFFECT_ToEFFECT]...';


GO
ALTER TABLE [dbo].[SPELLS_EFFECT]
    ADD CONSTRAINT [FK_SPELLS_EFFECT_ToEFFECT] FOREIGN KEY ([sef_efid]) REFERENCES [dbo].[EFFECT] ([ef_id]);


GO
PRINT N'Creating [dbo].[FK_ITEM_EFFECT_ToITEM]...';


GO
ALTER TABLE [dbo].[ITEM_EFFECT]
    ADD CONSTRAINT [FK_ITEM_EFFECT_ToITEM] FOREIGN KEY ([ie_iid]) REFERENCES [dbo].[ITEM] ([i_id]);


GO
PRINT N'Creating [dbo].[FK_ITEM_EFFECT_ToEFFECT]...';


GO
ALTER TABLE [dbo].[ITEM_EFFECT]
    ADD CONSTRAINT [FK_ITEM_EFFECT_ToEFFECT] FOREIGN KEY ([if_efid]) REFERENCES [dbo].[EFFECT] ([ef_id]);


GO
PRINT N'Creating [dbo].[FK_EFFECT_PROCEDURE_ToEFFECT]...';


GO
ALTER TABLE [dbo].[EFFECT_PROCEDURE]
    ADD CONSTRAINT [FK_EFFECT_PROCEDURE_ToEFFECT] FOREIGN KEY ([efp_efid]) REFERENCES [dbo].[EFFECT] ([ef_id]);


GO
PRINT N'Creating [dbo].[FK_EVENT_OCCURRED_TYPES_ToEVENT_OCCURRED]...';


GO
ALTER TABLE [dbo].[EVENT_OCCURRED_TYPES]
    ADD CONSTRAINT [FK_EVENT_OCCURRED_TYPES_ToEVENT_OCCURRED] FOREIGN KEY ([eot_eoid]) REFERENCES [dbo].[EVENT_OCCURRED] ([eo_id]);


GO
PRINT N'Creating [dbo].[FK_EVENT_OCCURRED_TYPES_ToEVENT_TYPE]...';


GO
ALTER TABLE [dbo].[EVENT_OCCURRED_TYPES]
    ADD CONSTRAINT [FK_EVENT_OCCURRED_TYPES_ToEVENT_TYPE] FOREIGN KEY ([eot_etid]) REFERENCES [dbo].[EVENT_TYPE] ([et_id]);


GO
PRINT N'Creating [dbo].[FK_RACE_BACKGROUND_ToRACE]...';


GO
ALTER TABLE [dbo].[RACE_BACKGROUND]
    ADD CONSTRAINT [FK_RACE_BACKGROUND_ToRACE] FOREIGN KEY ([rb_rid]) REFERENCES [dbo].[RACE] ([r_id]);


GO
PRINT N'Creating [dbo].[FK_RACE_BACKGROUND_ToBACKGROUND]...';


GO
ALTER TABLE [dbo].[RACE_BACKGROUND]
    ADD CONSTRAINT [FK_RACE_BACKGROUND_ToBACKGROUND] FOREIGN KEY ([rb_bid]) REFERENCES [dbo].[BACKGROUND] ([b_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_CLASSES_ToCHARACTER]...';


GO
ALTER TABLE [dbo].[CHARACTER_CLASSES]
    ADD CONSTRAINT [FK_CHARACTER_CLASSES_ToCHARACTER] FOREIGN KEY ([ccl_cid]) REFERENCES [dbo].[CHARACTER] ([c_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_CLASSES_ToCLASS]...';


GO
ALTER TABLE [dbo].[CHARACTER_CLASSES]
    ADD CONSTRAINT [FK_CHARACTER_CLASSES_ToCLASS] FOREIGN KEY ([ccl_clid]) REFERENCES [dbo].[CLASS] ([cl_id]);


GO
PRINT N'Creating [dbo].[FK_RACE_ToABILITY]...';


GO
ALTER TABLE [dbo].[RACE]
    ADD CONSTRAINT [FK_RACE_ToABILITY] FOREIGN KEY ([r_aid]) REFERENCES [dbo].[ABILITY] ([a_id]);


GO
PRINT N'Creating [dbo].[FK_RACE_ToSKILL]...';


GO
ALTER TABLE [dbo].[RACE]
    ADD CONSTRAINT [FK_RACE_ToSKILL] FOREIGN KEY ([r_sid]) REFERENCES [dbo].[SKILL] ([s_id]);


GO
PRINT N'Creating [dbo].[FK_CLASS_ToABILITY]...';


GO
ALTER TABLE [dbo].[CLASS]
    ADD CONSTRAINT [FK_CLASS_ToABILITY] FOREIGN KEY ([cl_aid]) REFERENCES [dbo].[ABILITY] ([a_id]);


GO
PRINT N'Creating [dbo].[FK_CLASS_ToSKILL]...';


GO
ALTER TABLE [dbo].[CLASS]
    ADD CONSTRAINT [FK_CLASS_ToSKILL] FOREIGN KEY ([cl_sid]) REFERENCES [dbo].[SKILL] ([s_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_ToSPELLS_SLOTS_remaining]...';


GO
ALTER TABLE [dbo].[CHARACTER]
    ADD CONSTRAINT [FK_CHARACTER_ToSPELLS_SLOTS_remaining] FOREIGN KEY ([c_spellslots_remaining]) REFERENCES [dbo].[SPELLS_SLOTS] ([ss_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_ToSPELLS_SLOTS_total]...';


GO
ALTER TABLE [dbo].[CHARACTER]
    ADD CONSTRAINT [FK_CHARACTER_ToSPELLS_SLOTS_total] FOREIGN KEY ([c_spellslots_total]) REFERENCES [dbo].[SPELLS_SLOTS] ([ss_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_ToRACE]...';


GO
ALTER TABLE [dbo].[CHARACTER]
    ADD CONSTRAINT [FK_CHARACTER_ToRACE] FOREIGN KEY ([c_rid]) REFERENCES [dbo].[RACE] ([r_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_ToABILITY]...';


GO
ALTER TABLE [dbo].[CHARACTER]
    ADD CONSTRAINT [FK_CHARACTER_ToABILITY] FOREIGN KEY ([c_aid]) REFERENCES [dbo].[ABILITY] ([a_id]);


GO
PRINT N'Creating [dbo].[FK_CHARACTER_ToSKILL]...';


GO
ALTER TABLE [dbo].[CHARACTER]
    ADD CONSTRAINT [FK_CHARACTER_ToSKILL] FOREIGN KEY ([c_sid]) REFERENCES [dbo].[SKILL] ([s_id]);


GO
PRINT N'Creating [dbo].[FK_EVENT_OCCURRED_ToLOCATION]...';


GO
ALTER TABLE [dbo].[EVENT_OCCURRED]
    ADD CONSTRAINT [FK_EVENT_OCCURRED_ToLOCATION] FOREIGN KEY ([eo_lid]) REFERENCES [dbo].[LOCATION] ([l_id]);


GO
PRINT N'Creating [dbo].[FK_EVENT_OCCURRED_ToCAMPAIGN]...';


GO
ALTER TABLE [dbo].[EVENT_OCCURRED]
    ADD CONSTRAINT [FK_EVENT_OCCURRED_ToCAMPAIGN] FOREIGN KEY ([eo_cmpid]) REFERENCES [dbo].[CAMPAIGN] ([cmp_id]);


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2ef04809-7a81-4c48-84dc-d60454324082')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2ef04809-7a81-4c48-84dc-d60454324082')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0be15370-c3aa-4a2c-8abd-a9f9349c62d5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0be15370-c3aa-4a2c-8abd-a9f9349c62d5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '9284993b-9dab-42e7-8e2c-2b2b10584a7e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('9284993b-9dab-42e7-8e2c-2b2b10584a7e')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '29857e6b-a0df-41b6-bb68-a26c11af5c19')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('29857e6b-a0df-41b6-bb68-a26c11af5c19')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c31df340-28b8-44d7-8831-82746c3c2c5d')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c31df340-28b8-44d7-8831-82746c3c2c5d')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '487dddab-7cb9-47cd-b52c-94564f8e5f7b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('487dddab-7cb9-47cd-b52c-94564f8e5f7b')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '8c5327af-37c5-4042-b6a8-3f7a835de5c3')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('8c5327af-37c5-4042-b6a8-3f7a835de5c3')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '65b8cf8c-876b-4c0e-8c01-31db054aaef7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('65b8cf8c-876b-4c0e-8c01-31db054aaef7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'c2a577a8-0352-45d5-bb78-8f151d94ed02')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('c2a577a8-0352-45d5-bb78-8f151d94ed02')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a383708b-86d7-469e-97cf-92c4402897b7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a383708b-86d7-469e-97cf-92c4402897b7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ca191d7e-8554-4e9f-ab71-8fbf29414fb5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ca191d7e-8554-4e9f-ab71-8fbf29414fb5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5ddf9749-327a-4ad1-abd0-ef98dbc1f3cb')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5ddf9749-327a-4ad1-abd0-ef98dbc1f3cb')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2eeefe1b-c311-4fbf-b835-46f0725f9946')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2eeefe1b-c311-4fbf-b835-46f0725f9946')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '9c87c1aa-b0fc-4476-ac3b-5bca0d55978a')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('9c87c1aa-b0fc-4476-ac3b-5bca0d55978a')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0efeb0fc-99d1-48ff-b498-f40f5c63a4c9')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0efeb0fc-99d1-48ff-b498-f40f5c63a4c9')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '3931a7e7-d87c-49e7-8b45-33f4b5b1e354')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('3931a7e7-d87c-49e7-8b45-33f4b5b1e354')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2dda0855-5dea-4d64-a0bf-2db0bf502553')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2dda0855-5dea-4d64-a0bf-2db0bf502553')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5e45c6a8-5b65-4869-8a91-3587453642c1')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5e45c6a8-5b65-4869-8a91-3587453642c1')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '7a6df3fd-28a0-4990-9ae2-cdbc6eb35189')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('7a6df3fd-28a0-4990-9ae2-cdbc6eb35189')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5bc5bb79-113d-4e00-9567-e8aa2cdac468')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5bc5bb79-113d-4e00-9567-e8aa2cdac468')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'd35ec5b7-f2bf-4ca2-920f-79a94abeb286')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('d35ec5b7-f2bf-4ca2-920f-79a94abeb286')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ac4b99ea-ef61-493a-81f8-f42be49e01b5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ac4b99ea-ef61-493a-81f8-f42be49e01b5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a9fb77c0-cfe6-4fde-896c-7d37b4aa8c80')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a9fb77c0-cfe6-4fde-896c-7d37b4aa8c80')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '799b94ac-90ee-4773-833b-ca69f5443d64')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('799b94ac-90ee-4773-833b-ca69f5443d64')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'a6440e13-50c0-44ad-9d28-0010609e4cd5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('a6440e13-50c0-44ad-9d28-0010609e4cd5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0ac72929-1d99-482a-8f0e-70749fdb0bc7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0ac72929-1d99-482a-8f0e-70749fdb0bc7')

GO

GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET MULTI_USER 
    WITH ROLLBACK IMMEDIATE;


GO
PRINT N'Update complete.';


GO
